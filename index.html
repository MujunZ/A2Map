<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>MJ's A2 Map</title>
</head>
<body>
	<input class="inputbox" id="searchbox" data-bind="textInput: searchText">
   <p class="test" data-bind="text: searchText"></p>
   <p class="test" data-bind="text: locationList()[0].match"></p>
	<ul class="locationListBox" data-bind="foreach:locationList">
		<li class="locationBox" data-bind="text: title, visible:isVisible"></li>
	</ul>
	<script type="text/javascript" src = "js/lib/knockout-3.4.1.js"></script>
	<script type="text/javascript">
		var locations = [{
               title:'Godaiko Japanese Restaurant',
               location:{
                  lat:42.2409745,
                  lng:-83.7698831
               },
               content:'First Dinner!',
               match: null,

            },
            {
               title:'Pita Pita',
               location:{
                  lat:42.248919,
                  lng:-83.654703
               },
               content:'Faverate Restaruant',
               match: null
            },
            {
               title:'Chia Shiang',
               location:{
                  lat:42.2571668,
                  lng:-83.7299455
               },
               content:'Blacklist',
               match: null
            }
      	];

      	//@constructor
      	var Location = function (data) {
      		this.title = ko.observable(data.title);
            this.location = ko.observable(data.location);
            this.match = ko.observable(data.match);
            this.isVisible = ko.observable(true);
      	};

      	//ViewModel for KnockOut
      	var ViewModel = function () {
      		//Always use self=this in KO ViewModel to avoid further complexity
      		var self = this;

      		//make location list
      		self.locationList = ko.observableArray([]);
      		locations.forEach( function(locationItem) {
      			self.locationList.push(new Location(locationItem));
      		});

            //input text
            self.searchText = ko.observable('');

            //prepare the searchKey for .match()
            self.searchKey = ko.computed(function(){
               return new RegExp(self.searchText(), 'gi')
            },this);

            //match the searchKey in every locationList item
            self.locationList()[0].match = ko.computed(function(){
               return self.locationList()[0].title().match(self.searchKey());
            },this);

            //first item disappears if it matches the searchKey
            self.search = ko.computed(function () {
               if (self.locationList()[0].match() != null) {
                  self.locationList()[0].isVisible(true);
               } else {
                  self.locationList()[0].isVisible(false);
               };
            },this);
            

            // for(var i = 0, length1 = self.locationList.length; i < length1; i++){
            //    self.locationList[i].match = ko.computed(function () {
            //       self.locationList()[i].title().match(self.searchKey());
            //    },this);
            // };
      	};

      	ko.applyBindings(new ViewModel());
	</script>
</body>
</html>