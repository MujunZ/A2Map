var ViewModel=function(){function a(a){var b={url:"http://chart.googleapis.com/chart?chst=d_map_spin&chld=1.15|0|"+a+"|40|_|%E2%80%A2",size:new google.maps.Size(21,34),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(10,34),scaledSize:new google.maps.Size(21,34)};return b}var b=this,c=new google.maps.InfoWindow,d=(a("FF0080"),a("FFED00")),e="http://icons.iconarchive.com/icons/designbolts/despicable-me-2/48/Minion-Hello-icon.png",f=function(a){var f=this;this.title=ko.observable(a.title),this.position=a.location,this.location=ko.observable(a.location),this.tag=ko.observable(a.tag),this.isVisible=ko.observable(!0),this.marker=a.marker,this.clickCount=0,this.createMarkerWindow=function(){var a=this.contact,b=this.menu,c='<div class="markerWindow" id="markerWindow{{id}}"><h1 class="locationTitle">{{locationTitle}}</h1><p><a href="{{menu}}">menu</a></p><p class="locationPhone">Phone: {{locationPhone}}</p><p class="locationContent">MJ\'s Note: {{locationContent}}</p></div>';return this.windowContent=c.replace(/{{id}}/g,this.marker.id).replace(/{{locationTitle}}/g,this.marker.title).replace(/{{locationPhone}}/g,a).replace(/{{menu}}/g,b).replace(/{{locationContent}}/g,this.marker.content),this.windowContent},this.populateInfoWindow=function(a,b){this.getApi(b,a)},this.marker.addListener("click",function(){f.populateInfoWindow(c,f),this.setAnimation(google.maps.Animation.BOUNCE),setTimeout(function(){this.setAnimation(null)}.bind(this),750)}),this.marker.addListener("mouseover",function(){this.setIcon(d)}),this.marker.addListener("mouseout",function(){this.setIcon(e)}),this.setMarker=function(){this.marker.setMap(map),b.selectedTag("empty")},this.removeMarker=function(){this.marker.setMap(null),b.selectedTag("empty")},this.showMarker=function(){this.setMarker(),this.marker.setAnimation(google.maps.Animation.BOUNCE),setTimeout(function(){this.marker.setAnimation(null)}.bind(this),750),f.populateInfoWindow(c,f)},this.tipText=ko.observable('<span class="tooltiptext">Dubble click to hide the pin.</span>'),this.getApi=function(a,b){fourSquareInfo(a,b)}};b.locationList=ko.observableArray([]),locations.forEach(function(a){b.locationList.push(new f(a))}),b.restaurantTag=ko.observableArray([]),function(){index={};for(var a=0,c=locations.length;a<c;a++){var d=locations[a].tag;index[d]||(index[d]=!0,b.restaurantTag.push(d))}}(),b.restaurantTag().sort(),b.selectedTag=ko.observable(""),b.matchTag=ko.computed(function(){if("empty"!=b.selectedTag())for(var a=0,c=b.locationList().length;a<c;a++){var d=b.locationList()[a].tag().indexOf(b.selectedTag())!=-1;d?(b.locationList()[a].isVisible(!0),locations[a].visibility=!0,locations[a].marker.setMap(map)):(b.locationList()[a].isVisible(!1),locations[a].visibility=!1,locations[a].marker.setMap(null))}},this),b.searchText=ko.observable(""),b.search=ko.computed(function(){for(var a=0,c=b.locationList().length;a<c;a++){var d=b.locationList()[a].title().toLowerCase().indexOf(b.searchText().toLowerCase())!=-1;d?(b.locationList()[a].isVisible(!0),locations[a].visibility=!0,locations[a].marker.setMap(map)):(b.locationList()[a].isVisible(!1),locations[a].visibility=!1,locations[a].marker.setMap(null))}},this)};